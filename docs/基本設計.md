# 🏗️ 基本設計（軽量） — World Sudoku
**対象**: MVP中心（β/正式版の前提も併記）  
**準拠**: docs/suudoku_youken.md / docs/phase計画書.md / docs/詳細設計_MVP.md  
**作成日**: 2025-10-29

---

## 1. システム構成（論理）
- クライアント: Flutter（Dart）
  - 状態管理: Riverpod
  - 端末保存: ローカル設定（テーマ・言語など）
- バックエンド（段階導入）
  - MVP: なし（擬似デイリー＝assets JSON）
  - β: Firebase Firestore（デイリー配信取得）、Cloud Functions（日次登録）、FCM（通知）
  - 共通: PlayFab（ランキング/ユーザー）、AdMob（広告）

関係概要:
```
Flutter App ↔（β以降）Firestore/Functions/FCM
             ↔ PlayFab（β以降）
             ↔ AdMob（β以降）
```

---

## 2. 画面一覧と遷移
| 画面 | 目的 | 主要要素 | 遷移発火 |
|------|------|----------|----------|
| Home | 開始動線 | デイリー開始、通常Play、言語/スクリプト切替 | デイリー開始→Play、通常Play→難易度/言語選択→Play |
| Play | メインプレイ | 9×9盤、数字パッド、メモ、タイマー、ハイライト | クリア→Result、戻る→Home |
| Result | 結果確認 | タイム、難易度、スクリプト | 完了→Home |
| Settings | 設定 | UI言語 | 保存→戻る |

遷移図（簡略）:
```
Home ── デイリー開始 ─▶ Play ─▶ Result ─▶ Home
   └─ 通常Play（難易度/言語選択） ─▶ Play
```

---

## 3. インターフェース（I/F）定義（MVP→β）
| I/F | メソッド/エンドポイント | 入力 | 出力 | 実装段階 |
|-----|-------------------------|------|------|----------|
| PuzzleRepository | getDaily(date) | Date | Boardデータ | MVP=Local、β=Firestore |
| LocalDataSource | readAsset(path) | YYYY-MM-DD | JSON | MVP |
| RemoteDataSource | Firestore `puzzles/{date}` | YYYY-MM-DD | JSON | β |
| Notification | FCM push | topic=daily | 通知 | β |
| Ranking | PlayFab | time,difficulty | 送信結果 | β |

データ仕様（概要）は `docs/詳細設計_MVP.md` の4章を参照。

---

## 4. データフロー（主要ユースケース）
### 4.1 デイリー開始（MVP）
1) Homeで「デイリー開始」押下  
2) `getDaily(today)` 呼び出し  
3) LocalDataSource が `assets/puzzles/YYYY-MM-DD.json` を読み取り（固定配布データのみ。端末側生成はしない）  
4) Board生成 → Playへ遷移  
5) クリア時にResult表示（タイム）

フォールバック: 当日ファイルが無い場合は直近日付/固定サンプルを使用。

### 4.2 デイリー開始（β）
2) 以降が Firestore `puzzles/{date}` 取得に置き換わり、Cloud Functionsで日次登録、通知はFCM。未取得時は前回取得の前日分を練習扱いで起動（ランキング送信不可）

### 4.3 通常プレイ（MVP/β 共通）
1) Homeで「通常Play」押下  
2) 難易度（初級/中級 〈β以降: 上級〉）と言語/スクリプトを選択  
3) 選択内容を保持してPlay画面を開始（盤面は選択難易度のテンプレート/生成ロジックを使用）  
4) プレイ中はタイマー計測、重複は即時ハイライト  
5) クリア時にResultへ遷移し、クリア時間・難易度・スクリプトを表示  
6) タイトル（Home）に戻る  

---

## 5. 非機能要件（数値の確定）
| 区分 | 数値/方針 |
|------|-----------|
| 起動/表示性能 | 初期盤面表示2秒以内（中位端末） |
| 安定性 | クラッシュ率 < 2%（MVP）/ < 1.5%（β） |
| 容量 | 初回30MB以内（フォント含む） |
| 多言語 | LTR/RTL両対応、Noto系フォントで崩れなし |
| 対応OS | iOS 15+ / Android 11+（目安） |
| オフライン | 前日デイリーのキャッシュ起動可（練習扱い・ランキング不可） |

---

## 6. 環境・依存関係（導入段階）
- Flutter 3.x / Dart
- Noto Sans JP / Noto Naskh Arabic / Noto Sans（フォント）
- Firebase（Firestore/Functions/FCM）— β以降
- PlayFab（Leaderboard）— β以降
- Google AdMob — β以降

---

## 7. フェーズ整合（計画書との対応）
- MVP: 擬似デイリー（assets JSON）、通知/ランキング/広告なし
- β: Firestore取得＋日次自動登録（Functions）＋通知（FCM）＋ランキング/広告
- 正式: 収益化拡張・多言語拡張

---

## 8. 参照
- docs/suudoku_youken.md（要件定義）
- docs/phase計画書.md（フェーズ計画）
- docs/詳細設計_MVP.md（詳細仕様）


